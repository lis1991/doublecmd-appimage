version: 1

script:
  # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å–±–æ—Ä–∫—É
  - rm -rf AppDir || true

  # –°–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É AppDir
  - mkdir -p AppDir/usr/bin
  - mkdir -p AppDir/usr/share/applications
  - mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps

  # –°–∫–∞—á–∏–≤–∞–µ–º –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é Double Commander (QT6 x86_64)
  - echo "üîç –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Double Commander —á–µ—Ä–µ–∑ RSS..."
  - |
    LATEST_URL=$(curl -s "https://sourceforge.net/projects/doublecmd/rss?path=/" | \
      grep -o '<link>https://sourceforge.net/projects/doublecmd/files/[^"]*doublecmd-[0-9.]*\.qt6\.x86_64\.tar\.xz/download' | \
      head -1 | sed 's/<link>//')
    if [ -z "$LATEST_URL" ]; then
      echo "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª .qt6.x86_64.tar.xz –≤ RSS"
      exit 1
    fi
    echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º: $LATEST_URL"
    wget "$LATEST_URL" -O doublecmd.tar.xz

  - tar -xf doublecmd.tar.xz --strip-components=1 -C AppDir/usr/bin

  # --- –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ---
  - echo "üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ AppDir –ø–æ—Å–ª–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏:"
  - find AppDir -type f \( -name "*.desktop" -o -name "*.png" \) | head -n 10 || echo "–§–∞–π–ª—ã .desktop –∏–ª–∏ .png –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞–ø—Ä—è–º—É—é"
  # ------------------------------------------------

  # –ü–µ—Ä–µ–º–µ—â–∞–µ–º/–∫–æ–ø–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å –≤ usr/bin
  - |
    if [ -f "AppDir/usr/bin/doublecmd.png" ]; then
      echo "‚û°Ô∏è –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∏–∫–æ–Ω–∫—É –∏–∑ usr/bin"
      mv AppDir/usr/bin/doublecmd.png AppDir/usr/share/icons/hicolor/256x256/apps/
    elif [ -f "AppDir/usr/share/icons/hicolor/256x256/apps/doublecmd.png" ]; then
      echo "‚úÖ –ò–∫–æ–Ω–∫–∞ —É–∂–µ –Ω–∞ –º–µ—Å—Ç–µ"
    else
      echo "‚ö†Ô∏è –ò–∫–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∏–∫–æ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∑–∂–µ"
    fi

  # –°–æ–∑–¥–∞—ë–º .desktop —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ
  - |
    DESKTOP_FILE_PATH="AppDir/usr/share/applications/doublecmd.desktop"
    if [ ! -f "$DESKTOP_FILE_PATH" ]; then
      echo "‚úçÔ∏è –°–æ–∑–¥–∞—ë–º doublecmd.desktop"
      cat > "$DESKTOP_FILE_PATH" << 'EOF'
[Desktop Entry]
Version=1.0
Type=Application
Name=Double Commander
Comment=Cross Platform Open Source file manager
Exec=doublecmd %F
Icon=doublecmd
Terminal=false
Categories=Utility;FileTools;FileManager;
MimeType=inode/directory;
StartupNotify=true
EOF
    else
      echo "‚úÖ .desktop —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    fi

AppDir:
  path: ./AppDir

  app_info:
    id: org.doublecmd.DoubleCommander
    name: Double Commander
    icon: doublecmd # –ò–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ .png
    version: latest
    exec: usr/bin/doublecmd
    exec_args: $@

  # AppImageBuilder –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ ldd.
  # –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ apt –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è.
  apt:
    arch: amd64
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy main universe
    # include:
    #   - libgl1
    #   - libx11-6
    #   - –∏ —Ç.–¥.

  files:
    # exclude –Ω–µ –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –æ–Ω–∏ –Ω–µ –º–µ—à–∞—é—Ç
    # exclude:
    #   - usr/share/doc
    #   - usr/share/man
    #   - usr/share/locale

AppImage:
  arch: x86_64
  update-information: guess
  sign-key: None
