version: 1

script:
  # Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€ÑƒÑŽ ÑÐ±Ð¾Ñ€ÐºÑƒ
  - rm -rf AppDir || true

  # Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ AppDir
  - mkdir -p AppDir/usr/bin
  - mkdir -p AppDir/usr/share/applications
  - mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps

  # Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð¸ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Double Commander (QT6 x86_64)
  - echo "ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸ Double Commander Ñ‡ÐµÑ€ÐµÐ· RSS..."
  # Ð’ÐÐ–ÐÐž: Ð’ YAML Ð´Ð»Ñ Ð¼Ð½Ð¾Ð³Ð¾ÑÑ‚Ñ€Ð¾Ñ‡Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ñ€Ð°Ð·Ñ€Ñ‹Ð²Ð¾Ð² ÑÑ‚Ñ€Ð¾Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ">"
  # Ð¸ ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð²Ñ‹Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸.
  - >
    LATEST_URL=$(curl -s "https://sourceforge.net/projects/doublecmd/rss?path=/" |
    grep -o '<link>https://sourceforge.net/projects/doublecmd/files/[^"]*doublecmd-[0-9.]*\.qt6\.x86_64\.tar\.xz/download' |
    head -1 | sed 's/<link>//')

    if [ -z "$LATEST_URL" ]; then
      echo "âŒ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ñ„Ð°Ð¹Ð» .qt6.x86_64.tar.xz Ð² RSS"
      # ÐžÑ‚Ð»Ð°Ð´ÐºÐ°: Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ñ€Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‡Ð°ÑÑ‚Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
      # curl -s "https://sourceforge.net/projects/doublecmd/rss?path=/" | head -n 20
      exit 1
    fi
    echo "ðŸ“¥ Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°ÐµÐ¼: $LATEST_URL"
    wget "$LATEST_URL" -O doublecmd.tar.xz

  # Ð Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ñ‹Ð²Ð°ÐµÐ¼. --strip-components=1 ÑƒÐ´Ð°Ð»ÑÐµÑ‚ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð¾Ð² Ð¸Ð· Ð°Ñ€Ñ…Ð¸Ð²Ð°.
  - tar -xf doublecmd.tar.xz --strip-components=1 -C AppDir/usr/bin

  # --- ÐžÑ‚Ð»Ð°Ð´ÐºÐ°: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸ ---
  - echo "ðŸ” Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° AppDir Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸ (Ð¸Ñ‰ÐµÐ¼ .desktop Ð¸ .png):"
  - find AppDir -type f \( -name "doublecmd.desktop" -o -name "doublecmd.png" \) 2>/dev/null || echo "  Ð¤Ð°Ð¹Ð»Ñ‹ .desktop Ð¸Ð»Ð¸ .png Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ find'Ð¾Ð¼"
  # -----------------------------------------------------

  # ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ð¸ÐºÐ¾Ð½ÐºÑƒ
  # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: Ð˜ÐºÐ¾Ð½ÐºÐ° Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ð°Ð»Ð°ÑÑŒ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² usr/share/icons (Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹)
  - |
    if [ -f "AppDir/usr/share/icons/hicolor/256x256/apps/doublecmd.png" ]; then
      echo "âœ… Ð˜ÐºÐ¾Ð½ÐºÐ° ÑƒÐ¶Ðµ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ Ð² usr/share/icons/..."
    # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: Ð˜ÐºÐ¾Ð½ÐºÐ° Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ð°Ð»Ð°ÑÑŒ Ð² usr/bin (Ð½ÑƒÐ¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ)
    elif [ -f "AppDir/usr/bin/doublecmd.png" ]; then
      echo "âž¡ï¸ ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼ Ð¸ÐºÐ¾Ð½ÐºÑƒ Ð¸Ð· usr/bin Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¼ÐµÑÑ‚Ð¾"
      mv "AppDir/usr/bin/doublecmd.png" "AppDir/usr/share/icons/hicolor/256x256/apps/"
    else
      echo "âš ï¸ Ð˜ÐºÐ¾Ð½ÐºÐ° doublecmd.png Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸. AppImage Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°Ñ‚ÑŒ Ð¸ÐºÐ¾Ð½ÐºÑƒ."
    fi

  # ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ .desktop Ñ„Ð°Ð¹Ð»
  # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: .desktop Ñ„Ð°Ð¹Ð» Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ð°Ð»ÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² usr/share/applications (Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹)
  - |
    if [ -f "AppDir/usr/share/applications/doublecmd.desktop" ]; then
      echo "âœ… .desktop Ñ„Ð°Ð¹Ð» ÑƒÐ¶Ðµ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ Ð² usr/share/applications/"
      # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼, ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ Exec Ð² ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¼ Ñ„Ð°Ð¹Ð»Ðµ.
      # AppImageBuilder Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ 'doublecmd'
      # Ð•ÑÐ»Ð¸ Ð² .desktop ÑƒÐºÐ°Ð·Ð°Ð½ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ, ÑÑ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð¾Ð¹.
      # Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹, Ð¼Ñ‹ ÐµÐ³Ð¾ Ð½Ðµ Ñ‚Ñ€Ð¾Ð³Ð°ÐµÐ¼, Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°Ñ, Ñ‡Ñ‚Ð¾ Ð¾Ð½ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚ÐµÐ½.
    # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: .desktop Ñ„Ð°Ð¹Ð» Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²Ð°Ð»ÑÑ Ð² usr/bin (Ð½ÑƒÐ¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ)
    elif [ -f "AppDir/usr/bin/doublecmd.desktop" ]; then
      echo "âž¡ï¸ ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼ .desktop Ñ„Ð°Ð¹Ð» Ð¸Ð· usr/bin Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¼ÐµÑÑ‚Ð¾"
      mv "AppDir/usr/bin/doublecmd.desktop" "AppDir/usr/share/applications/"
    # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: .desktop Ñ„Ð°Ð¹Ð» Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ - ÑÐ¾Ð·Ð´Ð°Ñ‘Ð¼ ÐµÐ³Ð¾
    else
      echo "âœï¸ Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ doublecmd.desktop, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¾Ð½ Ð½Ðµ Ð±Ñ‹Ð» Ð½Ð°Ð¹Ð´ÐµÐ½"
      cat > "AppDir/usr/share/applications/doublecmd.desktop" << 'EOF'
[Desktop Entry]
Version=1.0
Type=Application
Name=Double Commander
Comment=Cross Platform Open Source file manager
# Ð’Ð°Ð¶Ð½Ð¾: Exec Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð½Ð° Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸Ðº Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÐºÐ¾Ñ€Ð½Ñ AppDir
Exec=doublecmd %F
# Icon Ñ‚Ð¾Ð¶Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð±ÐµÐ· Ð¿ÑƒÑ‚Ð¸ Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ
Icon=doublecmd
Terminal=false
Categories=Utility;FileTools;FileManager;
MimeType=inode/directory;
StartupNotify=true
EOF
    fi


AppDir:
  path: ./AppDir

  app_info:
    id: org.doublecmd.DoubleCommander
    name: Double Commander
    # Icon ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¿ÑƒÑ‚Ð¸ Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ, Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð»
    # doublecmd.png Ð±ÑƒÐ´ÐµÑ‚ Ð² usr/share/icons/... Ð¸Ð»Ð¸ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾Ð¼ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ðµ.
    icon: doublecmd
    version: latest
    # Exec Ð¿ÑƒÑ‚ÑŒ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ AppDir. AppImageBuilder ÑÐ°Ð¼ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ usr/bin Ð² $PATH.
    # Ð•ÑÐ»Ð¸ Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸Ðº Ð»ÐµÐ¶Ð¸Ñ‚ Ð² usr/bin/doublecmd, Ñ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð°Ðº:
    exec: usr/bin/doublecmd
    # exec: doublecmd # Ð­Ñ‚Ð¾Ñ‚ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ, ÐµÑÐ»Ð¸ usr/bin Ð² PATH Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ€ÐµÐ´Ñ‹ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸
    exec_args: $@

  # AppImageBuilder Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· ldd.
  # Ð¯Ð²Ð½Ð¾Ðµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ðµ apt Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾, Ð½Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¸Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°ÑŽÑ‰Ð¸Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð².
  apt:
    arch: amd64
    sources:
      # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ jammy, Ñ‚Ð°Ðº ÐºÐ°Ðº runner ubuntu-22.04
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy main universe
    # include: # Ð Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ²Ð½Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð°ÐºÐµÑ‚Ñ‹
    #   - libgl1
    #   - libx11-6
    #   - Ð¸ Ñ‚.Ð´.

  files:
    # Ð˜ÑÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð½ÐµÐ½ÑƒÐ¶Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° AppImage
    exclude:
      - usr/share/doc
      - usr/share/man
      - usr/share/locale
      # Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ, ÐµÑÐ»Ð¸ Ð½Ð°Ð¹Ð´ÑƒÑ‚ÑÑ

AppImage:
  arch: x86_64
  # update-information: guess # Ð Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ, ÐµÑÐ»Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
  sign-key: None # ÐŸÐ¾Ð´Ð¿Ð¸ÑÑŒ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°
