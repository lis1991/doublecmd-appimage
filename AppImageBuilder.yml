version: 1

script:
  # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å–±–æ—Ä–∫—É
  - rm -rf AppDir || true

  # –°–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É AppDir
  - mkdir -p AppDir/usr/bin
  - mkdir -p AppDir/usr/share/applications
  - mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps

  # –°–∫–∞—á–∏–≤–∞–µ–º –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é Double Commander (QT6 x86_64)
  - echo "üîç –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Double Commander —á–µ—Ä–µ–∑ RSS..."
  - |
    LATEST_URL=$(curl -s "https://sourceforge.net/projects/doublecmd/rss?path=/" | \
      grep -o '<link>https://sourceforge.net/projects/doublecmd/files/[^"]*doublecmd-[0-9.]*\.qt6\.x86_64\.tar\.xz/download' | \
      head -1 | sed 's/<link>//')
    if [ -z "$LATEST_URL" ]; then
      echo "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª .qt6.x86_64.tar.xz –≤ RSS"
      exit 1
    fi
    echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º: $LATEST_URL"
    wget "$LATEST_URL" -O doublecmd.tar.xz

  - tar -xf doublecmd.tar.xz --strip-components=1 -C AppDir/usr/bin
  - cp AppDir/usr/bin/doublecmd.png AppDir/usr/share/icons/hicolor/256x256/apps/
  - cp AppDir/usr/bin/doublecmd.desktop AppDir/usr/share/applications/

AppDir:
  path: ./AppDir

  app_info:
    id: org.doublecmd.DoubleCommander
    name: Double Commander
    icon: doublecmd
    version: latest
    exec: usr/bin/doublecmd
    exec_args: $@

  apt:
    arch: amd64
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy main universe
    include:
      - libgl1
      - libx11-6
      - libxext6
      - libxrender1
      - libxcb1
      - libxkbcommon-x11-0
      - libxcb-xinerama0
      - libxcb-cursor0
      - libxcb-keysyms1-0
      - libxcb-randr0
      - libxcb-xtest0
      - libxcb-shape0
      - libxcb-xfixes0
      - libfreetype6
      - libfontconfig1
      - libicu70
      - libpcre3
      - zlib1g

  files:
    exclude:
      - usr/share/doc
      - usr/share/man
      - usr/share/locale
      - usr/share/icons/hicolor/icon-theme.cache

AppImage:
  arch: x86_64
  update-information: guess
  sign-key: None
